<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ChatHistoryState">
    <option name="serializedSessions">
      <map>
        <entry key="9f49910f-ec20-4bf3-ae61-0e3f260ca6b5" value="{&quot;id&quot;:&quot;9f49910f-ec20-4bf3-ae61-0e3f260ca6b5&quot;,&quot;name&quot;:&quot;Implementing Notification Listener Service Status Check&quot;,&quot;timestamp&quot;:1743246729332,&quot;messages&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;\u003cuser_query\u003e\nAdd a method which checks that Notification listener service is actually running\n\u003c/user_query\u003e&quot;},{&quot;role&quot;:&quot;assistant&quot;,&quot;content&quot;:&quot;I\u0027ll add a method to check if the NotificationListener service is actually running. This is important because the shared preferences only track if the service is supposed to be enabled, but don\u0027t confirm if it\u0027s actually running.\n\nHere\u0027s the update to your MainActivity.kt:\n\n```kotlin:app/src/main/java/com/sgzmd/lileye/MainActivity.kt\n// ... existing code ...\n\nprivate fun isNotificationServiceEnabled(): Boolean {\n    val sharedPreferences \u003d getSharedPreferences(NOTIFICATION_LISTENER_PREFS, MODE_PRIVATE)\n    return sharedPreferences.getBoolean(IS_NOTIFICATION_LISTENER_ENABLED, false)\n}\n\nprivate fun isNotificationServiceRunning(): Boolean {\n    val serviceClass \u003d NotificationListener::class.java\n    val manager \u003d getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager\n    for (service in manager.getRunningServices(Integer.MAX_VALUE)) {\n        if (serviceClass.name \u003d\u003d service.service.className) {\n            return true\n        }\n    }\n    return false\n}\n\nprivate fun startNotificationListener() {\n// ... existing code ...\n```\n\nYou\u0027ll also need to add the missing import for ActivityManager and Context:\n\n```kotlin:app/src/main/java/com/sgzmd/lileye/MainActivity.kt\npackage com.sgzmd.lileye\n\nimport android.app.ActivityManager\nimport android.content.Context\nimport android.content.Intent\nimport android.os.Bundle\nimport android.provider.Settings\nimport android.widget.Button\nimport android.widget.Toast\nimport androidx.appcompat.app.AppCompatActivity\nimport com.sgzmd.lileye.service.NotificationListener\n// ... existing code ...\n```\n\nThe `isNotificationServiceRunning()` method will check if your NotificationListener service is actually running by looking through all active services. You can use this method alongside `isNotificationServiceEnabled()` to ensure both that the service is supposed to be running (based on shared preferences) and that it\u0027s actually running in the system.&quot;},{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;\u003cuser_query\u003e\ngetRunningServices is depreacted\n\u003c/user_query\u003e&quot;},{&quot;role&quot;:&quot;assistant&quot;,&quot;content&quot;:&quot;You\u0027re absolutely right! `getRunningServices()` is deprecated since Android Oreo (API 26) and doesn\u0027t provide complete information about running services in newer Android versions. Let\u0027s implement a better way to check if our notification listener service is running:\n\n```kotlin:app/src/main/java/com/sgzmd/lileye/MainActivity.kt\nprivate fun isNotificationServiceRunning(): Boolean {\n    val enabledNotificationListeners \u003d Settings.Secure.getString(\n        contentResolver, \n        \&quot;enabled_notification_listeners\&quot;\n    )\n    \n    val packageName \u003d packageName\n    return enabledNotificationListeners?.contains(packageName) \u003d\u003d true \u0026\u0026\n           NotificationManagerCompat.getEnabledListenerPackages(this).contains(packageName)\n}\n```\n\nMake sure to add this import at the top of your file:\n\n```kotlin\nimport androidx.core.app.NotificationManagerCompat\n```\n\nThis implementation checks two things:\n1. Whether our package is in Android\u0027s system setting that tracks enabled notification listeners\n2. Whether Android\u0027s NotificationManagerCompat reports our package as an enabled listener\n\nThis is a more reliable way to check if your notification listener service is actually enabled and should be running, rather than trying to check running services directly which is no longer reliable in modern Android versions.&quot;}]}" />
        <entry key="de6a74e4-4ff6-42f1-8d3b-f95d6e96e007" value="{&quot;id&quot;:&quot;de6a74e4-4ff6-42f1-8d3b-f95d6e96e007&quot;,&quot;name&quot;:&quot;New Chat&quot;,&quot;timestamp&quot;:1743246670739,&quot;messages&quot;:[]}" />
      </map>
    </option>
  </component>
</project>